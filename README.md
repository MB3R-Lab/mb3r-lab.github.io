# MB3R Lab Landing

Landing page for MB3R Lab with a pilot-request workflow, lightweight backend (Express + Supabase), confirmation emails, and a password-protected admin view.

## Quick start

1. **Install dependencies**
   ```bash
   npm install
   ```
2. **Configure environment**
   ```bash
   cp .env.example .env
   # then adjust PORT/ADMIN_PASSWORD/etc.
   ```
3. **Run the server**
   ```bash
   npm start
   ```
   The server serves the landing page (`/`), the admin dashboard (`/admin`), and exposes APIs under `/api`.

Use `npm run dev` for development with automatic restarts (requires `nodemon` from devDependencies).

## Features

- **CTA + modal form** — visitors leave an email, company, and optional comment for pilot onboarding. Validation happens on the client and the server.
- **Supabase storage** — submissions are persisted in the `applications` table of your Supabase project (via service-role key).
- **Mail service** — every submission triggers a confirmation email via Mailgun. Configure the sender plus API credentials via `MAIL_FROM`, `MAILGUN_API_KEY`, and `MAILGUN_DOMAIN`.
- **Admin dashboard** (`/admin`) — shows a table of submissions. Access requires a password entered in a modal (default `123456789@`, override via `ADMIN_PASSWORD`).
- **API endpoints**
  - `POST /api/applications` — accepts `{ email, company, comment? }` and returns the new `id`.
  - `GET /api/applications` — returns all submissions when the `x-admin-pass` header matches `ADMIN_PASSWORD`.

## Environment variables

| Name | Default | Description |
| --- | --- | --- |
| `PORT` | `3000` | HTTP port |
| `ADMIN_PASSWORD` | — | Password required by `/admin` UI and API header (must be set) |
| `SUPABASE_URL` | — | Supabase project URL |
| `SUPABASE_SERVICE_ROLE_KEY` | — | Service-role API key (used by the backend to read/write) |
| `MAIL_FROM` | `MB3R Lab <noreply@mb3r-lab.org>` | Sender shown in confirmation emails |
| `MAILGUN_API_KEY` | — | Mailgun private API key (required for email delivery) |
| `MAILGUN_DOMAIN` | — | Mailgun domain, e.g. `mg.example.com` |
| `MAILGUN_API_BASE_URL` | `https://api.mailgun.net/v3` | Override for EU region or custom edge |

## Supabase schema

When the server boots it automatically checks whether the `applications` table exists and runs the `CREATE TABLE` statement if it doesn’t. The SQL we issue is:

```sql
create table if not exists public.applications (
  id bigint generated by default as identity primary key,
  email text not null,
  company text not null,
  comment text,
  created_at timestamptz not null default now()
);
```

That logic uses the Supabase service-role key, so it works even with RLS enabled. If you prefer to manage schema manually, you can keep your own migrations—the auto-provision step is idempotent.

## Email testing

The backend now calls Mailgun's HTTP API directly. For local development you can keep `MAILGUN_*` variables empty; the server will skip the email send (logging a warning) but still accept submissions. To test delivery end-to-end, provision a Mailgun domain, set the variables, and submit the pilot form — Mailgun should show the event immediately in its dashboard.
